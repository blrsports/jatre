<!DOCTYPE html>
<html>

<head>
    <title>Jatre Finisher Picture</title>
    <meta name="_token" content="{{ csrf_token() }}">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
        crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Poppins" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg=" crossorigin="anonymous"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5CGEWPXQR2"></script>
    <script>
    
    </script>
</head>
<style type="text/css">
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial;
}

.mainDiv {
    overflow: scroll;
    max-height: 100vh;
}

.header {
  text-align: center;
  padding: 32px;
}

.row {
  display: -ms-flexbox; /* IE10 */
  display: flex;
  -ms-flex-wrap: wrap; /* IE10 */
  flex-wrap: wrap;
  padding: 0 4px;
  margin-left: 0.3rem;
}

/* Create four equal columns that sits next to each other */
.column {
  -ms-flex: 33%; /* IE10 */
  flex: 33%;
  max-width: 33%;
  padding:  4px;
}

.column img {
  margin-top: 8px;
  vertical-align: middle;
  width: 100%;
}

.modal-lg {
    max-width: 50%;
}
/* Responsive layout - makes a two column-layout instead of four columns */
@media screen and (max-width: 800px) {
  .column {
    -ms-flex: 50%;
    flex: 50%;
    max-width: 50%;
  }
}

/* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 600px) {
  .column {
    -ms-flex: 100%;
    flex: 100%;
    max-width: 100%;
  }
}


</style>

<body style="font-family: 'Poppins';">

    <div class="flex-container mainDiv" id="div-main">
        <div style="display:flex; justify-content:center;"><img src="images/brj-logo-1.png" style="margin-top: 20px; width: max(5vw, 10vh);"></img>
        </div>
        <h1 style="text-align:center;margin-top: 10px;color: #00B0EF; font-size: max(1.5vw, 2.8vh);"> These images are untagged !</h1>
        <h2 style="text-align:center;margin-top: 10px;color: #D01665; font-size: max(1vw, 2vh);">If you are seeing this, please click and tag the bibs to help your fellow runners !</h2>
        <div class="row">
            <div id="col1" class="column">
            </div>
            <div id="col2" class="column">
            </div>
            <div id="col3" class="column">
            </div>
        </div>
    </div>

    <div class="modal" tabindex="-1" role="dialog" id="myModal">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Help us tag the bibs if you are able to identify !</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="" class="imagepreview" style="width: 100%;">
                </div>
                <div class="modal-footer">
                    <label for="bib-number">Enter comma separated Bib numbers..</label>
                    <input type="text" placeholder="100001,100002" id="bib-number" name="name"
                        onfocus="this.placeholder = ''" onblur="this.placeholder = '100001,100002'" class="u-input u-input-rectangle" size="25%">

                    <button id="save_bib" type="button" class="btn btn-primary">Save changes</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>

    const handleClick = (src) => {
        $('.imagepreview').attr('src', src);
        $('#myModal').modal('toggle');
    }

    const init = () => {
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)>'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
        $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
        $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
    }
    
    $(document).ready(function () {

        // Load 
        init();

        $("#div-main").scroll(function () {
            if (Math.floor($(this).scrollTop() + $(this).innerHeight()) + 1 >= $(this)[0].scrollHeight) {
                
                $('#col1').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
                $('#col2').append($('<img src="http://34.75.54.212/Krishna-route/KKP02275.jpg" onclick="handleClick(this.src)">'));
                $('#col3').append($('<img src="http://34.75.54.212/Navya-Route-PD/_APT0265.jpg" onclick="handleClick(this.src)">'));
            }
        });

        $("#save_bib").click(function () {

            const image = $('.imagepreview').attr('src');
            let bibs = $('#bib-number').val();
            bibs = bibs.split(',');
            bibs = bibs.map(b => parseInt(b)).filter(n => !isNaN(n));

            console.log(JSON.stringify({
                "bib_number": bibs,
                "path": image
            }))

            $.ajax({
                type: 'post',
                url: 'http://134.75.54.212:8051/update_results',
                data: JSON.stringify({
                    "bib_number": bibs,
                    "path": image
                }),
                contentType: "application/json; charset=utf-8",
                traditional: true,
                success: function (data) {

                },
                error: function (error) {
                }
            });

        });


    });

    </script>
</body>



</html>